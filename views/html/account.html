<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Favicon -->
    <link rel="shortcut icon" href="./images/logo.png" type="image/x-icon">
    
    <!-- Box  icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/boxicons@latest/css/boxicons.min.css">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Overlock:wght@400;700&display=swap" rel="stylesheet"> 
    
    <!-- Custom Stylesheet -->
    <link rel="stylesheet" href="../css/style.css">
    <title>Food Company</title>
</head>
<body>
    <!-- Header -->
    <header id="home" class="header">
        <!-- Navigation -->
        <nav class="nav">
            <div class="navigation container">
              <a href="index.html">
                <div class="logo">
                    <img src="./images/logo.png">
                </div>
                </a>
    
                <div class="menu">
                    <div class="top-nav">
                        <div class="logo">
                            <img src="./images/logo.png">
                        </div>
                        <div class="close">
                            <i class='bx bx-x'></i>
                        </div>
                    </div>
                    <ul class="nav-list">
                      <li class="nav-item">
                        <a href="/home">Home &nbsp;&nbsp;&nbsp;&nbsp;</a>
                    </li>
                    <li class="nav-item">
                        <a href="/fruit&veg">Fruits & Vegetables &nbsp;&nbsp;&nbsp;&nbsp;</a>
                    </li>
                    <li class="nav-item">
                        <a href="/meat">Meat &nbsp;&nbsp;&nbsp;&nbsp;</a>
                    </li>

                    <li class="nav-item">
                        <a href="/dairy">Dairy &nbsp;&nbsp;&nbsp;&nbsp;</a>
                    </li>
                    <li class="nav-item">
                        <a href="/account">Account &nbsp;&nbsp;&nbsp;&nbsp;</a>
                    </li>
                        <li class="nav-item">
                          <a href="/cart"><i class='bx bx-cart'>&nbsp;&nbsp;&nbsp;&nbsp;</i></a>
                        </li> 
                    </ul>
                </div>
                <a href="cart.html" class="cart-icon"><i class='bx bx-cart'></i></a>
                <div class="nav-menu">
                    <i class='bx bx-menu' ></i>
                </div>
            </div>
        </nav>

        <!-- Login/Signup -->
        <center>
        <div class="wrapper">
          <div class="title-text">
             <div class="title login">
                Login / Signup
             </div>
             <div class="title signup">
              Login / Signup
             </div>
          </div>
          <div class="form-container">
             <div class="slide-controls">
                <input type="radio" name="slide" id="login" checked>
                <input type="radio" name="slide" id="signup">
                <label for="login" class="slide login">Login</label>
                <label for="signup" class="slide signup">Signup</label>
                <div class="slider-tab"></div>
             </div>
             <div class="form-inner">
                <form action="/signin" method="POST" class="login">
                   <div class="field">
                      <label for="emailaddress">Email Address</label>
                      <input type="text" placeholder="Email Address" name="email" required>
                   </div>
                   <br>
                   <div class="field">
                      <label for="password">Password</label>
                      <input type="password" placeholder="Password" name="password" required>
                   </div>
                   <br><br>
                   <div class="pass-link">
                      <a href="/uinfo">Forgot password?</a>
                   </div>
                  
                     <!--
                      <div class="btn-layer"></div>
                      <input onclick="submitForm(email.value,password.value)" type="submit" value="Login">
                     -->
                     <button type="button"  onClick=submitForm(email.value,password.value) class="btn btn-dark">Login</button>
                  
                   <div class="signup-link">
                      Not a member? <a href="">Signup now</a>
                   </div>
                </form>
                  <form>
                  <div class="field signup">
                    <label for="firstname">Firstname</label>
                    <input type="text" placeholder="First Name" name="first_name" required>
                 </div><br>
                 <div class="field">
                  <label for="lastname">Lastname</label>
                  <input type="text" placeholder="Last Name" name="last_name" required>
                </div>
                <br>
                   <div class="field">
                    <label for="emailaddress">Email Address</label>
                      <input type="email" placeholder="Email Address" name="email" required>
                   </div><br>
                   <div class="field">
                    <label for="dob">Date Of Birth</label>
                      <input type="date" placeholder="" name="date_of_birth" required>
                   </div><br>
                   <div class="field">
                    <label for="address">Address</label>
                      <input type="text" placeholder="Address" name="address" required>
                   </div><br>
                   <div class="field">
                    <label for="phone">Phone number</label>
                    <input type="tel" id="phone" name="phone" placeholder="123-456-7890"  pattern="[0-9]{10}" required>
                   </div><br>
                   <div class="field">
                    <label for="password">Password</label>
                    <input type="password" id="psw" name="password" pattern="(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{8,}" title="Must contain at least one number and one uppercase and lowercase letter, and at least 8 or more characters" placeholder="Password" required>
                   </div><br>
                   <!--Code Editing Starts Here-->
                   <div class="field">
                       <label for="confirm_password">Confirm Password</label>
                       <input type="password" id="cpsw" name="confirm_password" pattern="(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{8,}" title="Must contain at least one number and one uppercase and lowercase letter, and at least 8 or more characters" placeholder="Password" required >
                   </div><br>

                   <div class="field">
                       <label for="postal_code">Postal Code</label>
                       <input type="text" id="pcode" placeholder="Postal Code"  name="postal_code"required>
                   </div><br>

                   <div class="payment_div">
                     <div class="field">
                      <label for="card_number">Card Number</label>
                      <input type="text" id="cardNumber" placeholder="Enter Card Number" required>
                      </div>
                      <br>
                      <div class="field">
                      <label for="card_holder_name">Card Holder</label>
                      <input type="text" id="holderName" placeholder="Name on the card" required>
                      </div>
                      <br>
                      <div class="field">
                        <label for="expiry_date">EXPIRY</label>
                        <br>
                      <select name="month" id="expiryMonth" aria-required="true" placeholder="MM" minlength="2" maxlength="2" class="field form-control"><option value="01" aria-label="01">01</option><option value="02" aria-label="02">02</option><option value="03" aria-label="03">03</option><option value="04" aria-label="04">04</option><option value="05" aria-label="05">05</option><option value="06" aria-label="06">06</option><option value="07" aria-label="07">07</option><option value="08" aria-label="08">08</option><option value="09" aria-label="09">09</option><option value="10" aria-label="10">10</option><option value="11" aria-label="11">11</option><option value="12" aria-label="12">12</option></select>
                     
                     </div> 
                     <br>
                     <div class="field">
                      <select  name="year" aria-label="Expiry Year" id="expiryYear" aria-required="true" placeholder="YY" minlength="2" maxlength="2" class="field form-control"><option value="2021" aria-label="2021">2021</option><option value="2022" aria-label="2022">2022</option><option value="2023" aria-label="2023">2023</option><option value="2024" aria-label="2024">2024</option><option value="2025" aria-label="2025">2025</option><option value="2026" aria-label="2026">2026</option><option value="2027" aria-label="2027">2027</option><option value="2028" aria-label="2028">2028</option><option value="2029" aria-label="2029">2029</option><option value="2030" aria-label="2030">2030</option><option value="2031" aria-label="2031">2031</option><option value="2032" aria-label="2032">2032</option><option value="2033" aria-label="2033">2033</option><option value="2034" aria-label="2034">2034</option><option value="2035" aria-label="2035">2035</option><option value="2036" aria-label="2036">2036</option><option value="2037" aria-label="2037">2037</option><option value="2038" aria-label="2038">2038</option><option value="2039" aria-label="2039">2039</option><option value="2040" aria-label="2040">2040</option><option value="2041" aria-label="2041">2041</option><option value="2042" aria-label="2042">2042</option><option value="2043" aria-label="2043">2043</option><option value="2044" aria-label="2044">2044</option><option value="2045" aria-label="2045">2045</option><option value="2046" aria-label="2046">2046</option><option value="2047" aria-label="2047">2047</option><option value="2048" aria-label="2048">2048</option><option value="2049" aria-label="2049">2049</option><option value="2050" aria-label="2050">2050</option><option value="2051" aria-label="2051">2051</option><option value="2052" aria-label="2052">2052</option><option value="2053" aria-label="2053">2053</option><option value="2054" aria-label="2054">2054</option><option value="2055" aria-label="2055">2055</option><option value="2056" aria-label="2056">2056</option><option value="2057" aria-label="2057">2057</option><option value="2058" aria-label="2058">2058</option><option value="2059" aria-label="2059">2059</option><option value="2060" aria-label="2060">2060</option><option value="2061" aria-label="2061">2061</option><option value="2062" aria-label="2062">2062</option><option value="2063" aria-label="2063">2063</option><option value="2064" aria-label="2064">2064</option><option value="2065" aria-label="2065">2065</option><option value="2066" aria-label="2066">2066</option><option value="2067" aria-label="2067">2067</option><option value="2068" aria-label="2068">2068</option><option value="2069" aria-label="2069">2069</option><option value="2070" aria-label="2070">2070</option><option value="2071" aria-label="2071">2071</option></select>
                      </div>
                      <br>
                      <div class="field">
                      <label for="cvv">CVV</label>
                      <input type="text" id="cvvCode" placeholder="cvv code">
                      </div>
            
                 
                   </div>

                   <!--Code Editing ends Here-->
                   <button type="button"  onClick=registerNewUser(first_name.value,last_name.value,email.value,date_of_birth.value,address.value,phone.value,password.value,confirm_password.value,postal_code.value);enterCard() class="btn btn-dark">Register</button>
                </form>
             </div><br>
          </div>
       </div>
      </center><br><br>
      
        <!-- Footer -->
        <footer id="footer" class="section footer">
          <div class="container">
          <div class="footer-container">
              <div class="footer-center">
             
              <div class="footer-center">
              <h3>CONTACT US</h3>
              <div>
                  <span>
                  <i class="fas fa-map-marker-alt"></i>
                  </span>
                  577 Boul Henri-Bourassa E, Montréal, QC H2C 1E2
              </div>
              <div>
                  <span>
                  <i class="far fa-envelope"></i>
                  </span>
                  owner@info_orion.ca
              </div>
              <div>
                  <span>
                  <i class="fas fa-phone"></i>
                  </span>
                  123-456-7890
              </div>
              <div>
                  <span>
                  <i class="far fa-paper-plane"></i>
                  </span>
                  Montreal, Canada
              </div>
              </div>
          </div>
          </div>
          </div><br>
          <div class="copyright">
          <center><i class='bx bx-copyright'>Copyright Reserved By Cégep de la Gaspésie et des Îles, Montreal</i></center>
      </div>
      </footer>
    <!-- GSAP -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.7.1/gsap.min.js"></script>
    <!-- Custom Script -->
    <script src="./javascripts/index.js"></script>

    <script>
      const loginText = document.querySelector(".title-text .login");
      const loginForm = document.querySelector("form.login");
      const loginBtn = document.querySelector("label.login");
      const signupBtn = document.querySelector("label.signup");
      const signupLink = document.querySelector("form .signup-link a");
      signupBtn.onclick = (()=>{
       
        loginForm.style.marginLeft = "-50%";
        loginText.style.marginLeft = "-50%";
      });
      loginBtn.onclick = (()=>{
        loginForm.style.marginLeft = "0%";
        loginText.style.marginLeft = "0%";
      });
      signupLink.onclick = (()=>{
        
        signupBtn.click();
        window.alert("sometext");
        return false;
      });

      function submitForm(email,password)
      {
        $.ajax(
        {
          url:"http://localhost:6050/signin",
          type:"POST",
          data:{
            "email":email,
            "password":password
          },
          dataType:"json",
          success:(response)=>
          {
            console.log(response)
            console.log(response.count)
            if(response.count==0)
            { 
              localStorage.setItem("count",0);
              window.location.href="/homelogin";
            }
            if(response.count==2)
            {
              localStorage.setItem("count",0);
              window.location.href="/admin";
            }
            if(response.count==1)
            {
              localStorage.setItem("count",1);

              alert("Invalid Username or Password Enterted");
            }
            
          }
        })
      }

      function registerNewUser(firstname,lastname,email,dob,address,phone,password,confirmpassword,postalcode)
      {
        console.log("Inside Register New User");
        console.log(firstname);
        console.log(lastname);
        console.log(email);
        console.log(dob);
        console.log(address);
        console.log(phone);
        console.log(password);
        console.log(confirmpassword);
        console.log(postalcode);
        var counter=0;
        if(password!=confirmpassword)
        {
          alert("Passwords don't match")
          counter=1;
        }
       
        console.log("Enter Card Clicked successfully")
        let card_number=$("#cardNumber").val()
        let card_holder_name=$("#holderName").val()
      //To get the Selected Month from the dropdown
      var getMonthValue=document.getElementById("expiryMonth").selectedOptions[0].value;
      

      //To get the Selected Year from the dropdown
      var  getYearValue=document.getElementById("expiryYear").selectedOptions[0].value;
        let cvv_code=$("#cvvCode").val()

        console.log(card_number)
        console.log(card_holder_name)
        console.log(getMonthValue)
        console.log(getYearValue)
        console.log(cvv_code)

            //Get the current Year and month using Javascript
       var today=new Date()
    

      //Now Apply the Logic to Check if the card is expired or not
      //Variable for Current Year
      var current_year=parseInt(today.getFullYear())
      console.log(current_year)
      //Variable for Current Month
      var current_month=parseInt(today.getMonth())
      console.log(current_month)
      //variable for Selected Month
      var selected_month=parseInt(getMonthValue)
      console.log(selected_month)
      //variable for Selected Year
      var selected_year=parseInt(getYearValue)
      console.log(selected_year)

        if($("#cardNumber").val().length!=12)
        {
          alert("The Length of the Card Number must be 12 digits")
          counter=1
        }
        if($("#cvvCode").val().length!=3)
        {
          alert("The Length of the Security  Code must be 3 Digits")
          counter=1
        }

        if(current_year>=selected_year && current_month>selected_month)
        {   
            console.log("Wrong Card")
            alert("Sorry,Your card has Expired ,Please Use a different one")
            counter=1
        }
        if(counter==0)
        {
          $.ajax({
            url:"http://localhost:6050/addnewcard",
            method:"POST",
            dataType:"json",
            data:{
              "cardNumber":card_number,
              "cardHolderName":card_holder_name,
              "expiryMonth":getMonthValue,
              "expiryYear":getYearValue,
              "cvv":cvv_code
            },
            success:function(response)
            {
              console.log(response)
            }
          })
        }
        if(counter==0)
        {
          $.ajax({
            url:"http://localhost:6050/register",
            type:"POST",
            data:{
              "first_name":firstname,
              "last_name":lastname,
              "email":email,
              "date_of_birth":dob,
              "address":address,
              "phone":phone,
              "password":password,
              "confirm_password":confirmpassword,
              "postal_code":postalcode
            }
            ,
            dataType:"json",
            success:function(response)
            {
              console.log(response)
            console.log(response.counter)
            if(response.counter==0)
            { 
                alert("User Registered Successfully");
                window.location.reload();
            }
            else{
              alert("User already Exists");

            }
            }
            
          })

        }
        
      
      
      }
      //
      function enterCard()
      {
        console.log("Enter Card Clicked successfully")
        let card_number=$("#cardNumber").val()
        let card_holder_name=$("#holderName").val()
      //To get the Selected Month from the dropdown
      var getMonthValue=document.getElementById("expiryMonth").selectedOptions[0].value;
      

      //To get the Selected Year from the dropdown
      var  getYearValue=document.getElementById("expiryYear").selectedOptions[0].value;
        let cvv_code=$("#cvvCode").val()

        console.log(card_number)
        console.log(card_holder_name)
        console.log(getMonthValue)
        console.log(getYearValue)
        console.log(cvv_code)

            //Get the current Year and month using Javascript
       var today=new Date()
    

      //Now Apply the Logic to Check if the card is expired or not
      //Variable for Current Year
      var current_year=parseInt(today.getFullYear())
      console.log(current_year)
      //Variable for Current Month
      var current_month=parseInt(today.getMonth())
      console.log(current_month)
      //variable for Selected Month
      var selected_month=parseInt(getMonthValue)
      console.log(selected_month)
      //variable for Selected Year
      var selected_year=parseInt(getYearValue)
      console.log(selected_year)

        //counter to be used for the validations

        var counter=0
        if($("#cardNumber").val().length!=12)
        {
          alert("The Length of the Card Number must be 12 digits")
          counter=1
        }
        if($("#cvvCode").val().length!=3)
        {
          alert("The Length of the Security  Code must be 3 Digits")
          counter=1
        }

        if(current_year>=selected_year && current_month>selected_month)
        {   
            console.log("Wrong Card")
            alert("Sorry,Your card has Expired ,Please Use a different one")
            counter=1
        }
        if(counter==0)
        {
          $.ajax({
            url:"http://localhost:6050/addnewcard",
            method:"POST",
            dataType:"json",
            data:{
              "cardNumber":card_number,
              "cardHolderName":card_holder_name,
              "expiryMonth":getMonthValue,
              "expiryYear":getYearValue,
              "cvv":cvv_code
            },
            success:function(response)
            {
              console.log(response)
            }
          })
        }


      }
   </script>

</body>
</html>